version: '3.7'
services:
    nimble:
        image: nimble:latest
        container_name: application
    connect:
        image: debezium/connect:latest
        ports:
          - '8083:8083'
    minio:
        image: minio/minio:latest
        container_name: minio
        ports:
          - '9000:9000'
          - '9001:9001'
        command: server /data --console-address ":9001"
        environment:
          MINIO_ROOT_USER: minio
          MINIO_ROOT_PASSWORD: minio
        volumes:
          - minio:/data
    postgres:
        image: postgres:10.5
        restart: always
        environment:
          - POSTGRES_USER=postgres
          - POSTGRES_PASSWORD=postgres
          - PGDATA=/data/postgres
        logging:
          options:
            max-size: 10m
            max-file: "3"
        ports:
          - '5433:5432'
        volumes:
          - postgres_nimble:/data/postgres
    zookeeper:
        image: confluentinc/cp-zookeeper:6.2.0
        container_name: zookeeper
        environment:
          ZOOKEEPER_CLIENT_PORT: 2181
          ZOOKEEPER_TICK_TIME: 2000

    broker:
        image: confluentinc/cp-kafka:6.2.0
        container_name: broker
        ports:
          - "9092:9092"
        depends_on:
          - zookeeper
        environment:
          KAFKA_BROKER_ID: 1
          KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
          KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT
          KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://broker:29092
          KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
          KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
          KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
volumes:
    postgres_nimble:
    minio:
